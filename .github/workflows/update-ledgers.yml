name: Update ledgers
description: Update Aries ledgers

on:
  push:
    branches: [main]

  pull_request:
    branches: [main]

runs:
  steps:
    - name: Checkout bc-wallet-mobile
      uses: actions/checkout@v4

    - name: Setup NodeJS
      uses: ./.github/workflows/actions/setup-node

    - name: Install dependencies
      working-directory: app
      run: yarn install --immutable

    - name: Update Indy ledgers
      run: node app/scripts/refresh-ledgers.js

    - name: Commit and push changes
      run: |
        git config --local user.name "GitHub Actions"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

        if [[ -n $(git status --porcelain app/src/configs/ledgers/indy/ledgers.json) ]]; then
          git add app/src/configs/ledgers/indy/ledgers.json

          git commit -snm "chore(bot): updated Indy ledgers json file"

          git push
        else
          echo "ledgers.json is up to date, no changes to commit."
        fi
